# =====================================================================================================================
# Oracle Database + LDAP Configuration for Tests
#
# This profile provides Oracle database configuration combined with LDAP authentication for testing.
# Use with: --spring.profiles.active=oracle,ldap
# =====================================================================================================================

spring:
  # Oracle Database Configuration
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    url: jdbc:oracle:thin:@//localhost:1521/sitmun3
    username: sitmun3
    password: sitmun3
    driver-class-name: oracle.jdbc.OracleDriver
    hikari:
      poolName: TestOracleLdapHikari
      maximum-pool-size: 2
      minimum-idle: 1
      leak-detection-threshold: 15000
      connection-timeout: 30000
      idle-timeout: 300000
      max-lifetime: 600000
      data-source-properties:
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true

  # JPA Configuration for Oracle
  jpa:
    hibernate.ddl-auto: validate
    properties.hibernate.dialect: org.hibernate.dialect.OracleDialect
    properties.hibernate.type.preferred_boolean_jdbc_type: SMALLINT

  # Liquibase Configuration for Oracle
  liquibase:
    change-log: classpath:/db/changelog/db.changelog-oracle.yaml
    enabled: true
    drop-first: true
    url: jdbc:oracle:thin:@//localhost:1521/sitmun3?oracle.net.CONNECT_TIMEOUT=30000
    user: ${spring.datasource.username}
    password: ${spring.datasource.password}

# ===================================================================
# Test-specific Configuration
# ===================================================================
test:
  ldap:
    ldif: src/test/resources/ldap/test-server.ldif
    schema: src/test/resources/ldap/test-schema.ldif

# ===================================================================
# Management and Monitoring
# ===================================================================
management:
  health:
    ldap:
      enabled: true

# ===================================================================
# SITMUN LDAP Configuration
# ===================================================================
sitmun:
  authentication:
    ldap:
      url: ldap://localhost:8389
      base-dn: dc=diputaciolleida,dc=es
      user-dn-pattern: sAMAccountName={0},ou=Departamento
